# ğŸ“˜ã€ŠJava å¤šçº¿ç¨‹ç¼–ç¨‹å®æˆ˜ä¸ä¼˜åŒ–ã€‹æ•™æå¤§çº²

---

## ç¬¬ä¸€ç« ï¼šå¤šçº¿ç¨‹åŸºç¡€å›é¡¾

- 1.1 å¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«
- 1.2 çº¿ç¨‹ä¸è¿›ç¨‹æ¦‚å¿µ
- 1.3 Java ä¸­çš„çº¿ç¨‹æ¨¡å‹ç®€è¿°
- 1.4 `Thread` ä¸ `Runnable` çš„å®ç°æ–¹å¼
- 1.5 `Thread` ç”Ÿå‘½å‘¨æœŸä¸çŠ¶æ€è½¬æ¢å›¾
```sql
  NEW â†’ RUNNABLE â†’ RUNNING â†’ (WAITING/BLOCKED) â†’ RUNNABLE â†’ TERMINATED
  å¯é€šè¿‡ Thread.getState() è·å–å½“å‰çº¿ç¨‹çŠ¶æ€ã€‚
  NEWï¼šæ–°å»ºçŠ¶æ€ï¼Œçº¿ç¨‹å¯¹è±¡å·²åˆ›å»ºä½†æœªè°ƒç”¨ start()
  RUNNABLEï¼šå¯è¿è¡ŒçŠ¶æ€ï¼Œå·²å‡†å¤‡å¥½ç­‰å¾… CPU è°ƒåº¦
  BLOCKEDï¼šé˜»å¡çŠ¶æ€ï¼Œç­‰å¾…è·å–æŸä¸ªé”
  WAITING/TIMED_WAITINGï¼šä¸»åŠ¨è¿›å…¥ç­‰å¾…æˆ–é™æ—¶ç­‰å¾…
  TERMINATEDï¼šçº¿ç¨‹å·²ç»ˆæ­¢
```
- 1.6 `Thread` ä¸ `Runnable` å®ç°æ–¹å¼çš„æ ¸å¿ƒåŒºåˆ«

| æ¯”è¾ƒç»´åº¦       | ç»§æ‰¿ `Thread`                        | å®ç° `Runnable`                           |
|----------------|--------------------------------------|--------------------------------------------|
| ç±»çš„ç»§æ‰¿é™åˆ¶   | å·²ç»§æ‰¿ `Thread`ï¼Œä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»    | åªå®ç°æ¥å£ï¼Œå¯ç»§æ‰¿å…¶ä»–ç±»ï¼ˆæ›´çµæ´»ï¼‰        |
| èŒè´£åˆ†ç¦»       | çº¿ç¨‹é€»è¾‘å’Œçº¿ç¨‹æ§åˆ¶è€¦åˆåœ¨ä¸€èµ·         | ä»»åŠ¡é€»è¾‘ä¸çº¿ç¨‹åˆ†ç¦»ï¼Œæ›´æ¸…æ™°ã€å¯å¤ç”¨         |
| å¤šçº¿ç¨‹å…±äº«èµ„æº | ä¸æ–¹ä¾¿å…±äº«èµ„æº                      | å¯å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ª `Runnable` å®ä¾‹ä¸­çš„èµ„æº |
| èµ„æºæ¶ˆè€—       | æ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¯¹è±¡              | å¯ä»¥å¤ç”¨çº¿ç¨‹å¯¹è±¡ï¼Œé…åˆçº¿ç¨‹æ± æ›´é«˜æ•ˆ         |
| æ¨èç¨‹åº¦       | ä¸€èˆ¬ç”¨äºç®€å•åœºæ™¯                     | æ¨èä½¿ç”¨æ–¹å¼ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ                 |

> âœ… ç»“è®ºï¼š**æ¨èä¼˜å…ˆä½¿ç”¨ `Runnable` å®ç°æ–¹å¼**ï¼Œå…·æœ‰æ›´å¼ºçš„æ‰©å±•æ€§ã€èµ„æºå¤ç”¨èƒ½åŠ›ï¼Œä¾¿äºå’Œçº¿ç¨‹æ± æ•´åˆã€‚
- 1.7 ä»€ä¹ˆæ—¶å€™é€‚åˆä½¿ç”¨çº¿ç¨‹æ± ï¼ˆThreadPoolExecutorï¼‰

| åœºæ™¯ç±»å‹         | æ˜¯å¦é€‚åˆä½¿ç”¨çº¿ç¨‹æ±  | è¯´æ˜                                                                 |
|------------------|--------------------|----------------------------------------------------------------------|
| ä»»åŠ¡é¢‘ç¹ä¸”æ•°é‡å¤§ | âœ… é€‚åˆ             | å¯é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯çº¿ç¨‹å¸¦æ¥çš„æ€§èƒ½å¼€é”€                                |
| ä»»åŠ¡æ‰§è¡Œæ—¶é—´çŸ­   | âœ… é€‚åˆ             | å¯å¿«é€Ÿå¤ç”¨çº¿ç¨‹èµ„æºï¼Œæé«˜ç³»ç»Ÿååé‡                                  |
| æ§åˆ¶å¹¶å‘æ•°é‡     | âœ… é€‚åˆ             | é€šè¿‡æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°é™åˆ¶ç³»ç»Ÿå¹¶å‘é‡                            |
| ç³»ç»Ÿå¯¹æ€§èƒ½æ•æ„Ÿ   | âœ… é€‚åˆ             | æé«˜ CPU åˆ©ç”¨ç‡ï¼Œé¿å…èµ„æºæµªè´¹                                       |
| å¤šçº¿ç¨‹ä»»åŠ¡ç‹¬ç«‹   | âœ… é€‚åˆ             | æ¯ä¸ªä»»åŠ¡ä¹‹é—´æ— å…±äº«çŠ¶æ€ï¼Œçº¿ç¨‹æ± å¤„ç†æ›´é«˜æ•ˆ                            |
| èµ„æºæœ‰é™éœ€é˜²æ­¢ OOM | âœ… é€‚åˆ           | é€šè¿‡æœ‰ç•Œé˜Ÿåˆ—ä¸æ‹’ç»ç­–ç•¥é˜²æ­¢è¿‡åº¦åˆ›å»ºçº¿ç¨‹å¯¼è‡´å†…å­˜æº¢å‡º                 |
| ä¸´æ—¶ã€ä¸€æ¬¡æ€§ä»»åŠ¡ | âŒ ä¸é€‚åˆ           | ç›´æ¥ä½¿ç”¨ `new Thread()` åˆ›å»ºæ›´ç®€æ´ï¼Œçº¿ç¨‹æ± é…ç½®åè€Œæ˜¯è´Ÿæ‹…             |
| æ¯ä¸ªçº¿ç¨‹éœ€ç‹¬å èµ„æº | âŒ ä¸é€‚åˆ         | çº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹ä¼šå¯¼è‡´èµ„æºå†²çªï¼Œåº”æŒ‰éœ€åˆ›å»ºçº¿ç¨‹                         |
| ä¸ç¡®å®šä»»åŠ¡é‡ä¸”ä¸å¯æ§ | âš ï¸ æ…ç”¨        | å¦‚æœä»»åŠ¡æ¿€å¢ï¼Œçº¿ç¨‹æ± å¯èƒ½å †ç§¯ä»»åŠ¡å¯¼è‡´ç³»ç»Ÿèµ„æºè¢«è€—å°½ï¼Œåº”åˆç†é…ç½®å‚æ•° |

> âœ… **æ¨èå®è·µ**ï¼šä½¿ç”¨ `ThreadPoolExecutor` æ˜¾å¼æ„é€ çº¿ç¨‹æ± ï¼Œå¹¶åˆç†è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€é˜Ÿåˆ—å¤§å°å’Œæ‹’ç»ç­–ç•¥ã€‚


---

## ç¬¬äºŒç« ï¼šJava å†…ç½®çš„çº¿ç¨‹æ§åˆ¶æœºåˆ¶
### 2.1 çº¿ç¨‹å¯åŠ¨ã€æŒ‚èµ·ã€æ¢å¤ã€ç»ˆæ­¢
- **å¯åŠ¨**ï¼šé€šè¿‡ `Thread.start()` è°ƒç”¨ `run()` æ–¹æ³•ï¼ˆæœ¬è´¨æ˜¯JVMè°ƒç”¨`start0()`æœ¬åœ°æ–¹æ³•ï¼‰
- **æŒ‚èµ·/æ¢å¤**ï¼ˆå·²åºŸå¼ƒï¼‰ï¼š
  - ~~`Thread.suspend()`~~ï¼ˆæ˜“å¯¼è‡´æ­»é”ï¼‰
  - ~~`Thread.resume()`~~
  - æ›¿ä»£æ–¹æ¡ˆï¼šé€šè¿‡ `wait()`/`notify()` æœºåˆ¶å®ç°
- **ç»ˆæ­¢**ï¼ˆå·²åºŸå¼ƒï¼‰ï¼š
  - ~~`Thread.stop()`~~ï¼ˆä¼šå¯¼è‡´å¯¹è±¡çŠ¶æ€ä¸ä¸€è‡´ï¼‰
  - æ¨èæ–¹æ¡ˆï¼šä½¿ç”¨ä¸­æ–­æ ‡å¿—ä½ + `Thread.interrupt()`

### 2.2 synchronized é”æœºåˆ¶è¯¦è§£
```java
// ä¸‰ç§ä½¿ç”¨æ–¹å¼
public synchronized void method() {}  // å®ä¾‹é”
public static synchronized void method() {} // ç±»é”
synchronized(obj) { ... } // è‡ªå®šä¹‰å¯¹è±¡é”
```
- **å®ç°åŸç†**ï¼šåŸºäºå¯¹è±¡å¤´çš„Mark Wordå’ŒMonitorï¼ˆç®¡ç¨‹ï¼‰æœºåˆ¶
- **é”ç«äº‰**ï¼š
    - å½“çº¿ç¨‹è¿›å…¥åŒæ­¥å—æ—¶ï¼Œä¼šå°è¯•é€šè¿‡CASè·å–Monitorçš„_ownerå­—æ®µ
    - å¤±è´¥åè¿›å…¥ContentionListï¼ˆç«äº‰é˜Ÿåˆ—ï¼‰

---

### 2.3 Java é”çš„å®Œæ•´åˆ†ç±»ä¸å¯¹æ¯”
#### æŒ‰é”çš„å®ç°å±‚çº§åˆ†ç±»
| ç±»å‹        | ä½œç”¨èŒƒå›´               | å®ç°æ–¹å¼                            | å…¸å‹åœºæ™¯                 |
|-----------|--------------------|---------------------------------|----------------------|
| **å¯¹è±¡é”**   | å®ä¾‹æ–¹æ³•/ä»£ç å—          | `synchronized(this)` æˆ–å®ä¾‹åŒæ­¥æ–¹æ³•     | ä¿æŠ¤å®ä¾‹å˜é‡ï¼ˆå¦‚ç”¨æˆ·è®¢å•çŠ¶æ€ï¼‰    |
| **ç±»é”**    | é™æ€æ–¹æ³•/Classå¯¹è±¡      | `synchronized(MyClass.class)` æˆ–é™æ€åŒæ­¥æ–¹æ³• | ä¿æŠ¤é™æ€èµ„æºï¼ˆå¦‚å…¨å±€è®¡æ•°å™¨ï¼‰      |

#### æŒ‰é”çš„è®¾è®¡ç‰¹æ€§åˆ†ç±»
| ç±»å‹             | ç‰¹æ€§                                                                 | å®ç°ç±»                     |
|----------------|--------------------------------------------------------------------|-------------------------|
| **æ‚²è§‚é”**        | å‡å®šå¹¶å‘å†²çªå¿…ç„¶å‘ç”Ÿï¼Œå…ˆåŠ é”å†æ“ä½œ                                         | `synchronized`, `ReentrantLock` |
| **ä¹è§‚é”**        | å‡å®šæ— å†²çªï¼Œé€šè¿‡ç‰ˆæœ¬å·/CASæ£€æµ‹å†²çª                                        | `AtomicInteger`, `StampedLock` |
| **å¯é‡å…¥é”**       | åŒä¸€çº¿ç¨‹å¯é‡å¤è·å–å·²æŒæœ‰çš„é”                                              | `ReentrantLock`, `synchronized` |
| **å…¬å¹³é” vs éå…¬å¹³é”** | å…¬å¹³é”æŒ‰è¯·æ±‚é¡ºåºåˆ†é…é”ï¼›éå…¬å¹³é”å…è®¸æ’é˜Ÿï¼ˆ`synchronized`ä¸ºéå…¬å¹³é”ï¼‰                     | `ReentrantLock(true/false)` |

---

### 2.4 é”å‡çº§ä¸å¯é‡å…¥æ€§
#### é”çŠ¶æ€å˜è¿ï¼ˆJVMä¼˜åŒ–ï¼‰
1. **æ— é”**ï¼šæ–°å¯¹è±¡åˆå§‹çŠ¶æ€
2. **åå‘é”**ï¼šé€šè¿‡å¯¹è±¡å¤´å­˜å‚¨çº¿ç¨‹IDï¼ˆå•çº¿ç¨‹ä¼˜åŒ–ï¼‰
3. **è½»é‡çº§é”**ï¼šCASè‡ªæ—‹å°è¯•è·å–ï¼ˆä½ç«äº‰å¤šçº¿ç¨‹ï¼‰
4. **é‡é‡çº§é”**ï¼šæ“ä½œç³»ç»Ÿäº’æ–¥é‡ï¼ˆMutexï¼‰å®ç°é˜»å¡ï¼ˆé«˜ç«äº‰ï¼‰

#### å¯é‡å…¥æ€§å®ç°
- **è®¡æ•°å™¨æœºåˆ¶**ï¼šæ¯æ¬¡é‡å…¥é”è®¡æ•°å™¨+1ï¼Œé‡Šæ”¾æ—¶-1ï¼Œå½’é›¶åå®Œå…¨é‡Šæ”¾é”
```java
public synchronized void methodA() { 
    methodB(); // å¯é‡å…¥é”å…è®¸è°ƒç”¨å…¶ä»–åŒæ­¥æ–¹æ³•
}
public synchronized void methodB() {} 
```

---

### 2.5 volatile å…³é”®å­—åŸç†
```java
private volatile int count;
```
- **å†…å­˜å±éšœ**ï¼š
    - å†™æ“ä½œåæ’å…¥`StoreStore` + `StoreLoad`å±éšœï¼ˆå¼ºåˆ¶åˆ·æ–°ä¸»å†…å­˜ï¼‰
    - è¯»æ“ä½œå‰æ’å…¥`LoadLoad` + `LoadStore`å±éšœï¼ˆç¦æ­¢ä½¿ç”¨ç¼“å­˜ï¼‰
- **ç¦æ­¢é‡æ’åº**ï¼šé€šè¿‡å†…å­˜å±éšœä¿è¯æŒ‡ä»¤é¡ºåºæ€§
- **å±€é™æ€§**ï¼šä¸ä¿è¯å¤åˆæ“ä½œçš„åŸå­æ€§ï¼ˆå¦‚`i++`ï¼‰

---

### 2.6 å¹¶å‘ä¸‰ç‰¹æ€§ä¸å®ç°æœºåˆ¶
| ç‰¹æ€§         | å®šä¹‰                          | å®ç°æ‰‹æ®µ                                                                 |
|------------|-----------------------------|----------------------------------------------------------------------|
| **å¯è§æ€§**    | çº¿ç¨‹ä¿®æ”¹å¯¹å…¶å®ƒçº¿ç¨‹ç«‹å³å¯è§                | `volatile`ã€`synchronized`ã€`final`ï¼ˆé€šè¿‡å†…å­˜å±éšœæˆ–é”çš„happens-beforeè§„åˆ™ï¼‰ |
| **æœ‰åºæ€§**    | ç¨‹åºæŒ‰ä»£ç é¡ºåºæ‰§è¡Œ                    | `volatile`ã€`synchronized`ï¼ˆå†…å­˜å±éšœï¼‰ã€`happens-before`åŸåˆ™               |
| **åŸå­æ€§**    | æ“ä½œä¸å¯åˆ†å‰²                       | `synchronized`ã€`Lock`ã€`CAS`ï¼ˆå¦‚`AtomicInteger`ï¼‰                     |

---

### é™„ï¼šé”é€‰æ‹©å†³ç­–æµç¨‹å›¾
```mermaid
graph TD
    A[éœ€è¦çº¿ç¨‹åŒæ­¥] --> B{èµ„æºç±»å‹}
    B -->|å®ä¾‹å˜é‡| C[å¯¹è±¡é”]
    B -->|é™æ€å˜é‡| D[ç±»é”]
    C --> E{ç«äº‰å¼ºåº¦}
    D --> E
    E -->|ä½ç«äº‰| F[åå‘é”/è½»é‡çº§é”]
    E -->|é«˜ç«äº‰| G[é‡é‡çº§é”]
    F --> H{æ“ä½œç±»å‹}
    G --> H
    H -->|è¯»å¤šå†™å°‘| I[è¯»å†™é”]
    H -->|å†™å¤šè¯»å°‘| J[æ‚²è§‚é”]
```

> **å…³é”®æ€»ç»“**
> 1. ä¼˜å…ˆä½¿ç”¨`ReentrantLock`å®ç°è¶…æ—¶é”ç­‰å¾…ï¼ˆ`tryLock()`ï¼‰
> 2. å•ä¾‹æ¨¡å¼éœ€ç”¨`volatile`+åŒé‡æ£€æµ‹é¿å…æŒ‡ä»¤é‡æ’åºé—®é¢˜
> 3. é”ç²—åŒ–ï¼ˆåˆå¹¶åŒæ­¥å—ï¼‰å’Œé”æ¶ˆé™¤ï¼ˆJITä¼˜åŒ–ï¼‰å¯æå‡æ€§èƒ½
> 4. `ThreadLocal`æ˜¯é¿å…é”ç«äº‰çš„æ›¿ä»£æ–¹æ¡ˆï¼ˆçº¿ç¨‹å°é—­ï¼‰
```


## ç¬¬ä¸‰ç« ï¼šå¹¶å‘å·¥å…·ç±»è¯¦è§£ï¼ˆjava.util.concurrentï¼‰
### 3.1 Executor æ¡†æ¶è¯¦è§£ï¼ˆçº¿ç¨‹æ± åŸç†ï¼‰

- **æ ¸å¿ƒæ¥å£å±‚æ¬¡**  
  - `Executor`ï¼šæœ€åŸºç¡€æ¥å£ï¼Œä»…å®šä¹‰ `execute(Runnable)`ï¼›  
  - `ExecutorService`ï¼šæ‰©å±•æ¥å£ï¼Œæ”¯æŒ `submit`ã€`invokeAll`ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼›  
  - `ThreadPoolExecutor`ï¼šçº¿ç¨‹æ± æ ¸å¿ƒå®ç°ï¼Œå¯ç²¾ç»†é…ç½®ï¼›  
  - `Executors`ï¼šå·¥å‚ç±»ï¼Œæä¾›å¿«æ·çº¿ç¨‹æ± å®ç°ï¼ˆç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼‰ã€‚

- **æ‰§è¡Œæµç¨‹**  
  1. è°ƒç”¨ `execute`/`submit` æäº¤ä»»åŠ¡ï¼›  
  2. è‹¥è¿è¡Œçº¿ç¨‹æ•° < `corePoolSize`ï¼Œæ–°å»ºæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œï¼›  
  3. å¦åˆ™ï¼Œä»»åŠ¡å…¥ `workQueue`ï¼›  
  4. è‹¥é˜Ÿåˆ—å·²æ»¡ä¸”çº¿ç¨‹æ•° < `maximumPoolSize`ï¼Œæ–°å»ºéæ ¸å¿ƒçº¿ç¨‹ï¼›  
  5. è‹¥ä»æ— æ³•å…¥é˜Ÿä¸”çº¿ç¨‹æ•°å·²åˆ°ä¸Šé™ï¼Œè§¦å‘æ‹’ç»ç­–ç•¥ã€‚

---

### 3.2 çº¿ç¨‹æ± é…ç½®ä¸ä¼˜åŒ–ç­–ç•¥

#### 3.2.1 æ ¸å¿ƒçº¿ç¨‹æ•° ä¸ æœ€å¤§çº¿ç¨‹æ•°

- **`corePoolSize`**  
  - CPU å¯†é›†å‹ï¼š`CPU æ ¸å¿ƒæ•° + 1`ï¼›  
  - I/O å¯†é›†å‹ï¼š`2 Ã— CPU æ ¸å¿ƒæ•°`ã€‚  

- **`maximumPoolSize`**  
  - ç”¨äºåº”å¯¹çŸ­æ—¶é«˜å¹¶å‘ã€‚  
  - è®¾ç½®è¿‡é«˜æ˜“å¯¼è‡´èµ„æºè€—å°½ï¼›è¿‡ä½æ˜“è§¦å‘æ‹’ç»ã€‚

#### 3.2.2 é˜»å¡é˜Ÿåˆ— é€‰æ‹©

| é˜Ÿåˆ—ç±»å‹                  | ç‰¹æ€§                             | é€‚ç”¨åœºæ™¯                           |
|---------------------------|----------------------------------|------------------------------------|
| `LinkedBlockingQueue`     | å¯é€‰æ— ç•Œï¼ˆé»˜è®¤ï¼‰æˆ–æœ‰ç•Œï¼›ååé«˜     | å¯¹å»¶è¿Ÿä¸æ•æ„Ÿã€å¤§é‡ä»»åŠ¡ç§¯å‹         |
| `ArrayBlockingQueue`      | å›ºå®šå®¹é‡ï¼›æ”¯æŒå…¬å¹³/éå…¬å¹³         | å®¹é‡å¯æ§ã€å»¶è¿Ÿæ•æ„Ÿåœºæ™¯             |
| `SynchronousQueue`        | å®¹é‡ä¸º 0ï¼›ç›´æ¥äº¤ä»˜                | `newCachedThreadPool()`ï¼Œå¿«é€Ÿæ‰©ç¼©å®¹ |
| `PriorityBlockingQueue`   | æ”¯æŒä¼˜å…ˆçº§æ’åº                    | éœ€ä¼˜å…ˆçº§è°ƒåº¦çš„ä»»åŠ¡                 |
| `DelayQueue`ã€`LinkedTransferQueue` ç­‰ | ä¸“ç”¨åœºæ™¯ï¼ˆå®šæ—¶ã€ä¼ è¾“ï¼‰      | å®šæ—¶ä»»åŠ¡æˆ–ç”Ÿäº§/æ¶ˆè´¹ä¼ è¾“            |

#### 3.2.3 æ‹’ç»ç­–ç•¥ï¼ˆ`RejectedExecutionHandler`ï¼‰

- **å†…ç½®ç­–ç•¥**  
  - `AbortPolicy`ï¼šæŠ›å‡ºå¼‚å¸¸ï¼›  
  - `CallerRunsPolicy`ï¼šç”±è°ƒç”¨è€…çº¿ç¨‹æ‰§è¡Œï¼›  
  - `DiscardPolicy`ï¼šä¸¢å¼ƒå½“å‰ä»»åŠ¡ï¼›  
  - `DiscardOldestPolicy`ï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€è€ä»»åŠ¡ã€‚  
- **è‡ªå®šä¹‰**ï¼šå¯è®°å½•æ—¥å¿—ã€æŠ¥è­¦æˆ–é™çº§å¤„ç†ã€‚

#### 3.2.4 å­˜æ´»æ—¶é—´ ä¸ æ ¸å¿ƒçº¿ç¨‹å›æ”¶

- **`keepAliveTime`**ï¼šéæ ¸å¿ƒçº¿ç¨‹ç©ºé—²è¶…æ—¶åè¢«å›æ”¶ã€‚  
- **`allowCoreThreadTimeOut(true)`**ï¼šå¼€å¯åï¼Œæ ¸å¿ƒçº¿ç¨‹äº¦å¯è¶…æ—¶é”€æ¯ã€‚  
- **è°ƒä¼˜**ï¼š  
  - ç¬æ—¶é«˜å³°ï¼šä½è¶…æ—¶ï¼ŒåŠæ—¶é‡Šæ”¾èµ„æºï¼›  
  - ç¨³å®šè´Ÿè½½ï¼šé€‚å½“å»¶é•¿ï¼Œå‡å°‘é¢‘ç¹é”€æ¯/é‡å»ºã€‚

#### 3.2.5 ç»¼åˆè°ƒä¼˜æµç¨‹

1. **è¯„ä¼°ä¸šåŠ¡ç‰¹æ€§**ï¼šCPU/IO æ¯”é‡ã€å¹¶å‘å³°å€¼ã€æŒç»­æ—¶é—´ï¼›  
2. **åˆå§‹å‚æ•°è®¾å®š**ï¼š`core`ã€`max`ã€`queue`ï¼›  
3. **å‹æµ‹ä¸ç›‘æ§**ï¼šå…³æ³¨ `ActiveCount`ã€`QueueSize`ã€`RejectedCount`ï¼›  
4. **åŠ¨æ€è°ƒæ•´**ï¼šé€šè¿‡ JMX æˆ– Spring çš„ `ThreadPoolTaskExecutor`ï¼›  
5. **æ‹’ç» & é™çº§**ï¼šå³æ—¶å¤„ç†æ‹’ç»ï¼Œé¿å…æœåŠ¡é›ªå´©ã€‚

---

### 3.3 Future ä¸ Callable ä½¿ç”¨

#### 3.3.1 Runnable vs. Callable

- **`Runnable`**ï¼šæ— è¿”å›å€¼ï¼Œä¸æŠ›å—æ£€å¼‚å¸¸ã€‚  
- **`Callable<V>`**ï¼šæ”¯æŒè¿”å›å€¼ä¸å¼‚å¸¸ï¼›é€‚åˆéœ€è·å–ç»“æœçš„ä»»åŠ¡ã€‚

#### 3.3.2 Future æ¥å£

- **è·å–ç»“æœ**  
  ```java
  Future<V> future = executor.submit(callable);
  V result = future.get();              // é˜»å¡
  V result2 = future.get(1, TimeUnit.SECONDS); // å¸¦è¶…æ—¶
  ```
- **çŠ¶æ€æŸ¥è¯¢**ï¼š`isDone()`ã€`isCancelled()`
- **å–æ¶ˆä»»åŠ¡**ï¼š`cancel(true)`ï¼ˆå¯ä¸­æ–­ï¼‰æˆ– `cancel(false)`

#### 3.3.3 FutureTask è¿›é˜¶

```java
FutureTask<String> ft = new FutureTask<>(() -> heavyCompute());
executor.execute(ft);
// â€¦
// å¤ç”¨æˆ–ç¼“å­˜
String res = ft.get();
```
- **ç”¨æ³•**
    - **ç¼“å­˜**ï¼šåŒä¸€è¯·æ±‚å¤ç”¨åŒä¸€ `FutureTask`ï¼›
    - **é¢„åŠ è½½**ï¼šå¯åŠ¨æ—¶å¼‚æ­¥è®¡ç®—ã€æå‰åˆå§‹åŒ–èµ„æºã€‚

#### 3.3.4 å¼‚å¸¸ä¸å–æ¶ˆæœ€ä½³å®è·µ

1. **æ•è· ExecutionException**
   ```java
   try { future.get(); }
   catch (ExecutionException e) {
     Throwable cause = e.getCause();
   }
   ```
2. **è¶…æ—¶è·å–**ï¼šé˜²æ­¢é•¿æ—¶é˜»å¡ï¼›
3. **ä»»åŠ¡ä¸­æ–­**ï¼šåœ¨ä»»åŠ¡ä½“å†…å®šæœŸæ£€æŸ¥ `Thread.interrupted()`ã€‚

#### 3.3.5 CompletableFuture ç®€ä»‹

- JavaÂ 8 æä¾›ï¼Œæ”¯æŒï¼š
    - é“¾å¼å¼‚æ­¥ (`thenApply`ã€`thenCompose`)ï¼›
    - å¼‚å¸¸å¤„ç† (`exceptionally`)ï¼›
    - ä¸è‡ªå®šä¹‰çº¿ç¨‹æ± ç»“åˆä½¿ç”¨ã€‚

---

### 3.4 å¹¶å‘æ§åˆ¶å™¨

- **CountDownLatch**
  ```java
  CountDownLatch latch = new CountDownLatch(n);
  // å­çº¿ç¨‹æ‰§è¡Œå®Œè°ƒç”¨ latch.countDown();
  // ä¸»çº¿ç¨‹ await ç­‰å¾…
  ```
- **CyclicBarrier**
  ```java
  CyclicBarrier barrier = new CyclicBarrier(n, () -> { /* æ±‡æ€»é€»è¾‘ */ });
  // å„çº¿ç¨‹ barrier.await();
  ```
- **Semaphore**
  ```java
  Semaphore sem = new Semaphore(permits);
  sem.acquire();
  // è®¿é—®å—é™èµ„æº
  sem.release();
  ```

---

### 3.5 é«˜çº§é”

- **ReentrantLock**
  ```java
  ReentrantLock lock = new ReentrantLock(true); // å…¬å¹³é”
  lock.lockInterruptibly();
  try { /* ä¸´ç•ŒåŒº */ }
  finally { lock.unlock(); }
  ```
- **ReadWriteLock**
  ```java
  ReadWriteLock rw = new ReentrantReadWriteLock();
  rw.readLock().lock();
  // å¤šè¯»å¹¶è¡Œ
  rw.writeLock().lock();
  // ç‹¬å å†™
  ```
- **Condition**ï¼ˆæ›¿ä»£ `wait/notify`ï¼‰
  ```java
  Condition cond = lock.newCondition();
  cond.await();     // é‡Šæ”¾é”å¹¶ç­‰å¾…
  cond.signalAll(); // å”¤é†’ç­‰å¾…çº¿ç¨‹
  ```

---

### 3.6 ThreadLocal ä¸ InheritableThreadLocal

- **ThreadLocal**
  ```java
  ThreadLocal<Conn> tl = ThreadLocal.withInitial(() -> createConn());
  Conn c = tl.get();
  ```
    - åœºæ™¯ï¼šçº¿ç¨‹éš”ç¦»çš„è¿æ¥ã€ä¸Šä¸‹æ–‡ä¿¡æ¯ã€çº¿ç¨‹å®‰å…¨çš„æ ¼å¼åŒ–ç­‰ï¼›
    - é™·é˜±ï¼šçº¿ç¨‹æ± ä¸­ä¸è°ƒç”¨ `remove()` æ˜“å¯¼è‡´å†…å­˜æ³„æ¼ã€‚

- **InheritableThreadLocal**
    - å­çº¿ç¨‹ç»§æ‰¿çˆ¶çº¿ç¨‹å˜é‡åˆå§‹å€¼ï¼›
    - åœ¨çº¿ç¨‹æ± ä¸­æ— æ•ˆï¼Œå› çº¿ç¨‹å¤ç”¨ï¼Œä¸æ¨èç”¨äºè·¨çº¿ç¨‹ä¼ é€’ã€‚

---

> **æç¤º**ï¼šå¦‚éœ€æºç å‰–æã€æ€§èƒ½æµ‹è¯•è„šæœ¬æˆ–å®æˆ˜æ¡ˆä¾‹ï¼Œå¯è¿›ä¸€æ­¥äº¤æµï¼
---

## ç¬¬å››ç« ï¼šJ.U.C å¹¶å‘å®¹å™¨ä¸å¹¶å‘é›†åˆ

- 4.1 `ConcurrentHashMap` å†…éƒ¨ç»“æ„æ¼”è¿›ï¼ˆJDK7 vs JDK8ï¼‰
- 4.2 `CopyOnWriteArrayList`, `ConcurrentLinkedQueue`, `BlockingQueue`
- 4.3 å¤šçº¿ç¨‹å®‰å…¨é›†åˆé€‚ç”¨åœºæ™¯åˆ†æ

---

## ç¬¬äº”ç« ï¼šåŸå­ç±»ä¸æ— é”ç¼–ç¨‹

- 5.1 `AtomicInteger`, `AtomicReference` ç­‰åŸå­ç±»åŸç†
- 5.2 CAS ä¸ ABA é—®é¢˜
- 5.3 Unsafe ç±»ç®€ä»‹
- 5.4 LongAdder ä¸æ€§èƒ½ä¼˜åŒ–

---

## ç¬¬å…­ç« ï¼šå¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼ä¸å®è·µ

- 6.1 ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼ˆé˜»å¡é˜Ÿåˆ— vs æ˜¾å¼é”ï¼‰
- 6.2 çº¿ç¨‹æ± åŒ–æ¨¡å¼ï¼ˆThreadPoolExecutor è‡ªå®šä¹‰å®ç°ï¼‰
- 6.3 å·¥ä½œçªƒå–æ¨¡å¼ï¼ˆForkJoinPoolï¼‰
- 6.4 Actor æ¨¡å¼ç®€ä»‹ï¼ˆAkka ä¸å¼‚æ­¥æ¶ˆæ¯ï¼‰
- 6.5 Future æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼åœ¨å¹¶å‘ä¸­çš„åº”ç”¨

---

## ç¬¬ä¸ƒç« ï¼šå¼‚æ­¥ç¼–ç¨‹ä¸å“åº”å¼ç¼–ç¨‹åˆæ¢

- 7.1 Java CompletableFuture æ·±å…¥è®²è§£
- 7.2 `CompletionStage` æ¥å£é“¾å¼ç»„åˆ
- 7.3 Spring å¼‚æ­¥æ”¯æŒï¼ˆ@Asyncï¼‰
- 7.4 ç®€ä»‹ Reactor ä¸ RxJava

---

## ç¬¬å…«ç« ï¼šå¹¶å‘ç¨‹åºçš„è°ƒè¯•ä¸æ€§èƒ½åˆ†æ

- 8.1 æ­»é”åˆ†æä¸æ£€æµ‹ï¼ˆjstack, jconsole, visualvmï¼‰
- 8.2 çº¿ç¨‹çŠ¶æ€ç›‘æ§ä¸è¯Šæ–­
- 8.3 é”ç«äº‰ä¸èµ„æºäº‰ç”¨åˆ†æ
- 8.4 æ€§èƒ½åˆ†æå·¥å…·ï¼šJMHã€perfã€arthas
- 8.5 å®è·µï¼šä½¿ç”¨ JMH å¯¹æ¯” `synchronized` å’Œ `ReentrantLock`

---

## ç¬¬ä¹ç« ï¼šé«˜å¹¶å‘æ¶æ„ä¸­çš„å¤šçº¿ç¨‹åº”ç”¨æ¡ˆä¾‹

- 9.1 ç”µå•†ä¸‹å•å¹¶å‘å¤„ç†æ¶æ„è®¾è®¡
- 9.2 ç§’æ€ç³»ç»Ÿä¸­çš„å¹¶å‘æ§åˆ¶ç­–ç•¥
- 9.3 æ—¥å¿—ç³»ç»Ÿä¸­çš„å¼‚æ­¥å†™å…¥å®ç°
- 9.4 åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ä¸­çš„çº¿ç¨‹æ± è®¾è®¡
- 9.5 å¾®æœåŠ¡ç½‘å…³ä¸­çš„å¹¶å‘æ§åˆ¶ç‚¹ï¼ˆé™æµã€ç†”æ–­ã€éš”ç¦»ï¼‰

---

## ç¬¬åç« ï¼šé«˜çº§ä¸»é¢˜ä¸å‘å±•è¶‹åŠ¿

- 10.1 è™šæ‹Ÿçº¿ç¨‹ï¼ˆProject Loomï¼‰åˆæ¢
- 10.2 çº¿ç¨‹ä¸åç¨‹æ¯”è¾ƒï¼ˆå¯¹æ ‡ Kotlinã€Golangï¼‰
- 10.3 ä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹æ¨¡å‹çš„å¯¹æ¯”ç†è§£
- 10.4 å¹¶å‘æ¨¡å‹çš„æ¼”è¿›ä¸æœªæ¥æ–¹å‘
