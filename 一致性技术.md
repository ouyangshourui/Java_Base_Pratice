# 一致性模型与Java锁综合指南

## 一致性模型对比表（含业务场景与Java锁实现）
| 对比维度         | 强一致性 (Strong)                          | 最终一致性 (Eventual)                     |
|------------------|--------------------------------------------|--------------------------------------------|
| **数据时效性**   | 立即可见                                   | 延迟可见（秒级~分钟级）                    |
| **性能吞吐**     | 1k-5k TPS                                 | 50k-1M+ TPS                               |
| **实现复杂度**   | 2PC/Paxos/分布式锁                         | MQ/CRDT/版本向量                           |
| **业务场景**     | 银行转账/证券交易/库存扣减                  | 社交点赞/用户行为分析/日志聚合             |
| **Java锁实现**   | `ReentrantLock`/`synchronized`/`Redisson` | `StampedLock`/`ReadWriteLock`/`LongAdder` |
| **容错机制**     | 同步阻塞+事务回滚                          | 异步重试+补偿事务                          |
| **资源消耗**     | 高（CPU 30%-50%）                          | 低（CPU 5%-15%）                          |
---

## 全链路一致性决策图（含一致性要求）
```mermaid
graph LR
    Start{需要强一致性?} -->|是| Strong[强一致性方案]
    Start -->|否| Eventual[最终一致性方案]

    click Strong toggleStrong
    click Eventual toggleEventual

    subgraph toggleStrong[强一致性技术路径]
        Strong --> Arch{分布式系统?}
        Arch -->|是| Consensus[共识协议]
        Arch -->|否| Local[本地锁机制]
        
        Consensus -->|多节点协调| Protocol[协议选择]
        Protocol -->|Leader选举| Raft
        Protocol -->|崩溃恢复| Paxos
        Protocol -->|原子广播| ZAB
        
        Consensus -->|数据同步| DLock[分布式锁]
        DLock -->|强一致| ZK[ZooKeeper]
        DLock -->|高吞吐| RedisL[Redisson]
        DLock -->|自研系统| RaftL[Raft实现]
        
        Local --> Process{进程间共享?}
        Process -->|跨进程| PLock[进程锁]
        PLock -->|内存共享| Sem[Semaphore]
        PLock -->|网络通信| RPCL[RPC锁]
        
        Process -->|单进程| JLock[Java锁]
        JLock --> Feature{锁特性需求}
        Feature -->|可重入| Reentrant[ReentrantLock]
        Feature -->|读写分离| RWLock[ReadWriteLock]
        Feature -->|乐观读| Stamp[StampedLock]
        Feature -->|原子操作| Atomic[Atomic变量]
    end

    subgraph toggleEventual[最终一致性技术路径]
        Eventual --> Repair{数据修复能力?}
        Repair -->|支持补偿| Comp[补偿机制]
        Repair -->|无需修复| Queue[消息队列]
        
        Comp -->|事务补偿| Saga[Saga模式]
        Comp -->|业务补偿| TCC[TCC模式]
        Comp -->|自动重试| Retry[重试队列]
        
        Queue -->|日志型| Kafka
        Queue -->|事务型| RocketMQ
        Queue -->|轻量级| RedisQ[Redis Stream]
        
        Eventual --> Version{数据版本控制}
        Version -->|冲突解决| CRDT
        Version -->|时间序列| Vector[版本向量]
    end
```
